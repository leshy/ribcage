// Generated by CoffeeScript 1.8.0
(function() {
  var CoffeeScript, async, backbone, colors, fs, helpers, loadSettings, logger, path, pluggy, _;

  path = require('path');

  CoffeeScript = require('coffee-script');

  logger = require('logger2');

  async = require('async');

  backbone = require('backbone4000');

  colors = require('colors');

  _ = require('underscore');

  helpers = require('helpers');

  pluggy = require('pluggy');

  fs = require('fs');

  exports.init = function(options, callback) {
    var env;
    if (options == null) {
      options = {};
    }
    env = options.env || {};
    env.root = path.dirname(require.main.filename);
    env.settings = loadSettings(env.root, env.settings);
    console.log('settings', env.settings);
    return pluggy.loadPlugins({
      dir: env.root,
      prefix: 'ribcage',
      env: env
    }, function(err, data) {
      return console.log('loadplugins res', err, data);
    });
  };

  loadSettings = function(folder, settings) {
    var settingsCoffee;
    if (settings == null) {
      settings = {};
    }
    if (fs.existsSync(settingsCoffee = helpers.path(folder, 'settings.coffee'))) {
      fs.writeFileSync(helpers.path(folder, 'settings.js'), CoffeeScript.compile(String(fs.readFileSync(settingsCoffee))));
    }
    if (fs.existsSync(folder + '/settings.js')) {
      _.extend(settings, require('./settings').settings);
    }
    return settings;
  };

  exports.init();

}).call(this);
